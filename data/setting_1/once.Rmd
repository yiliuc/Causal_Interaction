---
output: pdf_document
---
```{r, echo=FALSE, message=FALSE}
library(purrr)
source("scripts/summary_table/summary_fitting_once.R")
source("scripts/summary_table/summary_fitting_Btimes.R")
source("scripts/kable_graph/making_kable.R")
source("scripts/kable_graph/bias_graph.R")
```

# Testing different models (fitting one time)

## Using control only

### $\beta_0=-6$: prevalence $\approx0.01$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -6, seed = 2025)$summary_table
make_reri_table(sumamry_table, beta0 = -6)
```

```{r}
data <- simulate_data_intercept(3000, -4.5, 2025)
model <- glm(Y ~ G * E + X1+ X2 + X3 + X4 + X5 + X6, data = data, family = binomial(link = "logit"))
# model <- glm(Y ~ G * E, data = data, family = binomial(link = "logit"))
summary(model)

compute_RERI_OR(1.05413, 0.96932, 0.15710)
```

```{r}
install.packages("interactionR")
library(interactionR)
table_object = interactionR(model, exposure_names = c("G", "E"), ci.type = "mover", ci.level = 0.95, em = F, recode = F)
interactionR_table(table_object)
```

```{r}
## --- prerequisites ---------------------------------------------------------
library(stats)
set.seed(2025)

## --- simulation settings ---------------------------------------------------
B        <- 2000               # number of Monte-Carlo repetitions
n        <- 3000               # sample size
beta0    <- -3                 # intercept in simulate_data_intercept()
yearseed <- 2025               # base seed used inside simulate_data_intercept()

## --- helper: one run returns RERI_OR --------------------------------------
one_run_reri <- function(n, beta0) {
  dat <- simulate_data_intercept(n, beta0)
  fit <-glm(Y ~ G * E + X1+ X2 + X3 + X4 + X5 + X6, data = dat, family = binomial(link = "logit"))

  b     <- coef(fit)           # intercept, G, E, G:E
  b_G   <- b["G"]
  b_E   <- b["E"]
  b_GE  <- b["G:E"]

  reri  <- exp(b_G + b_E + b_GE) - exp(b_G) - exp(b_E) + 1
  reri
}

## --- single-core version ---------------------------------------------------
reri_vec <- replicate(B, one_run_reri(n, beta0))
mean_reri <- mean(reri_vec)

mean_reri        # ← average RERI over 2 000 simulations


```

### $\beta_0=-4.5$: prevalence $\approx0.05$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -4.5, seed = 2025)$summary_table
make_reri_table(sumamry_table, beta0 = -4.5)
```

### $\beta_0=-3.7$: prevalence $\approx0.1$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -3.7, seed = 2025)$summary_table
make_reri_table(sumamry_table, beta0 = -3.7)
```

### $\beta_0=-3$: prevalence $\approx0.2$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -3, seed = 2025)$summary_table
make_reri_table(sumamry_table, beta0 = -3)
```


\newpage


### $\beta_0=-2$: prevalence $\approx0.4$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -2, seed = 2025)$summary_table
make_reri_table(sumamry_table, beta0 = -2)
```

### $\beta_0=-1$: prevalence $\approx0.6$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -1, seed = 2025)$summary_table
make_reri_table(sumamry_table, beta0 = -1)
```


\newpage


## Using both control and case

### $\beta_0=-6$: prevalence $\approx0.01$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -6, use = "both", seed = 2025)$summary_table
make_reri_table(sumamry_table, beta0 = -6)
```


### $\beta_0=-4.5$: prevalence $\approx0.05$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -4.5, use = "both", seed = 2025)$summary_table
make_reri_table(sumamry_table, beta0 = -4.5)
```

### $\beta_0=-3.7$: prevalence $\approx0.1$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -3.7, use = "both", seed = 2025)$summary_table
make_reri_table(sumamry_table, beta0 = -3.7)
```

### $\beta_0=-3$: prevalence $\approx0.2$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -3, use = "both", seed = 2025)$summary_table
make_reri_table(sumamry_table, beta0 = -3)
```


\newpage


### $\beta_0=-2$: prevalence $\approx0.4$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -2, use = "both")$summary_table
make_reri_table(sumamry_table, beta0 = -2)
```

### $\beta_0=-1$: prevalence $\approx0.6$

```{r, echo=FALSE, warning=FALSE}
sumamry_table <- fit_once(beta0 = -1, use = "both")$summary_table
make_reri_table(sumamry_table, beta0 = -1)
```